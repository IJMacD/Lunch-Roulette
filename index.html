<!doctype html>
<!-- saved from url=(0076)http://tpstatic.com/_sotc/sites/default/files/1010/source/roulettewheel.html -->
<html>
  <head>
    <meta charset="utf-8">
    <title>Roulette Wheel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      html,
      body {
        height: 100%;
      }
      canvas {
        height: 100%;
        position: absolute;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <canvas id="wheelcanvas"></canvas>
    <script>
      var restaraunts = ["源記燒味", "泰樂廚", "金田長壽司", "五穀豐收",
                       "座雲吞麵", "泰屋", "麵包新語", "Home Stay",
                       "漢城美食"];

      var numRestaurants = restaraunts.length;
      var startAngle = 0;
      var arc = Math.PI * 2 / numRestaurants;
      var spinTimeout = null;

      var spinArcStart = 10;
      var spinTime = 0;
      var spinTimeTotal = 0;

      var ctx;

      var canvas,
          canvasWidth,
          canvasHeight,
          relevantSize,
          cX,
          cY;

      init();

      function init(){
        canvas = document.getElementById("wheelcanvas");

        calculateSize();

        addEvents();
      }

      function calculateSize(){

        var devicePixelRatio = window.devicePixelRatio || 1;

        canvasWidth = canvas.clientWidth * devicePixelRatio;
        canvasHeight = canvas.clientHeight * devicePixelRatio;

        canvas.width = canvasWidth;
        canvas.height = canvasHeight;

        cX = canvasWidth / 2;
        cY = canvasHeight / 2;

        relevantSize = Math.min(canvasWidth, canvasHeight);

        draw();
      }

      function addEvents(){

        canvas.addEventListener("click", spin);

        window.addEventListener("resize", calculateSize);
      }

      function draw() {
        drawRouletteWheel();
      }

      function drawRouletteWheel() {
        var canvas = document.getElementById("wheelcanvas");
        if (canvas.getContext) {
          var outsideRadius = 0.4 * relevantSize;
          var textRadius = 0.32 * relevantSize;
          var insideRadius = 0 * relevantSize;

          ctx = canvas.getContext("2d");
          ctx.clearRect(0,0,canvasWidth,canvasHeight);


          ctx.strokeStyle = "black";
          ctx.lineWidth = 2;

          ctx.font = 'bold 20px sans-serif';

          for(var i = 0; i < numRestaurants; i++) {
            var angle = startAngle + i * arc;
            ctx.fillStyle = "hsl(" + rtod(i * arc) + ", 80%, 50%)";

            ctx.beginPath();
            ctx.arc(cX, cY, outsideRadius, angle, angle + arc, false);
            ctx.arc(cX, cY, insideRadius, angle + arc, angle, true);
            ctx.stroke();
            ctx.fill();

            ctx.save();
            ctx.lineWidth = 1;
            ctx.strokeStyle = "white";
            ctx.fillStyle = "black";
            ctx.translate(cX + Math.cos(angle + arc / 2) * textRadius, cY + Math.sin(angle + arc / 2) * textRadius);
            ctx.rotate(angle + arc / 2 + Math.PI / 2);
            var text = restaraunts[i];
            ctx.strokeText(text, -ctx.measureText(text).width / 2, 0);
            ctx.fillText(text, -ctx.measureText(text).width / 2, 0);
            ctx.restore();
          }

          //Arrow
          ctx.fillStyle = "black";
          ctx.beginPath();
          ctx.moveTo(cX - 4, cY - (outsideRadius + 5));
          ctx.lineTo(cX + 4, cY - (outsideRadius + 5));
          ctx.lineTo(cX + 4, cY - (outsideRadius - 5));
          ctx.lineTo(cX + 9, cY - (outsideRadius - 5));
          ctx.lineTo(cX + 0, cY - (outsideRadius - 13));
          ctx.lineTo(cX - 9, cY - (outsideRadius - 5));
          ctx.lineTo(cX - 4, cY - (outsideRadius - 5));
          ctx.lineTo(cX - 4, cY - (outsideRadius + 5));
          ctx.fill();
        }
      }

      function spin() {
        spinAngleStart = Math.random() * 10 + 10;
        spinTime = 0;
        spinTimeTotal = Math.random() * 3 + 4 * 1000;
        rotateWheel();
      }

      function rotateWheel() {
        spinTime += 16;
        if(spinTime >= spinTimeTotal) {
          stopRotateWheel();
          return;
        }
        var spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
        startAngle += (spinAngle * Math.PI / 180);
        drawRouletteWheel();
        spinTimeout = setTimeout('rotateWheel()', 30);
      }

      function stopRotateWheel() {
        clearTimeout(spinTimeout);
        var degrees = startAngle * 180 / Math.PI + 90;
        var arcd = arc * 180 / Math.PI;
        var index = Math.floor((360 - degrees % 360) / arcd);
        ctx.save();
        ctx.font = 'bold 30px sans-serif';
        ctx.shadowOffsetX = -1;
        ctx.shadowOffsetY = -1;
        //ctx.shadowColor   = "rgb(220,220,220)";
        ctx.strokeStyle = "white";
        ctx.lineWidth = 2;
        var text = restaraunts[index]
        ctx.strokeText(text, cX - ctx.measureText(text).width / 2, cY + 10);
        ctx.fillText(text, cX - ctx.measureText(text).width / 2, cY + 10);
        ctx.restore();
      }

      function easeOut(t, b, c, d) {
        var ts = (t/=d)*t;
        var tc = ts*t;
        return b+c*(tc + -3*ts + 3*t);
      }

      function rtod(radians){
        return radians * 180 / Math.PI;
      }
    </script>
  </body>
</html>
